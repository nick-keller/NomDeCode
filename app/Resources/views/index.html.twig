{% extends '::base.html.twig' %}

{% block body %}

<!-- fake data -->

{% set colors = ['655492', 'C15B68', '80CED7', '76C46F'] %}
{% set author = {
	'photo': 'https://dl.dropboxusercontent.com/u/18517066/nomdecode/author.png',
	'name': 'Jean-Elie',
	'color': colors[0]
} %}
{% set categories = [
	{
		'name': "Symfony",
		'img': 'https://dl.dropboxusercontent.com/u/18517066/nomdecode/categories/symfony.png'
	},
	{
		'name': "PHP",
		'img': 'https://dl.dropboxusercontent.com/u/18517066/nomdecode/categories/php.png'
	},
	{
		'name': "JS",
		'img': 'https://dl.dropboxusercontent.com/u/18517066/nomdecode/categories/js.png'
	}
] %}
{% set article_listed = {
	'author': author,
	'categories': categories,
	'date': date(),
	'illustration': 'https://dl.dropboxusercontent.com/u/18517066/nomdecode/fond.jpg',
	'title': 'Le plus beau titre possible, gros bisous les enfants'
} %}
{% set article = {
	'author': author,
	'categories': categories,
	'date': date(),
	'illustration': 'https://dl.dropboxusercontent.com/u/18517066/nomdecode/fond.jpg',
	'title': 'Le plus beau titre possible, gros bisous les enfants',
	'content': '
	<h1>HTML Ipsum Presents</h1>
	       
	<p><strong>Pellentesque habitant morbi tristique</strong> senectus et netus et malesuada fames ac turpis egestas. Vestibulum tortor quam, feugiat vitae, ultricies eget, tempor sit amet, ante. Donec eu libero sit amet quam egestas semper. <em>Aenean ultricies mi vitae est.</em> Mauris placerat eleifend leo. Quisque sit amet est et sapien ullamcorper pharetra. Vestibulum erat wisi, condimentum sed, <code>commodo vitae</code>, ornare sit amet, wisi. Aenean fermentum, elit eget tincidunt condimentum, eros ipsum rutrum orci, sagittis tempus lacus enim ac dui. <a href="#">Donec non enim</a> in turpis pulvinar facilisis. Ut felis.</p>

	<h2>Header Level 2</h2>
		       
	<ol>
	   <li>Lorem ipsum dolor sit amet, consectetuer adipiscing elit.</li>
	   <li>Aliquam tincidunt mauris eu risus.</li>
	</ol>

	<img src="https://dl.dropboxusercontent.com/u/18517066/nomdecode/fond.jpg">
	       
	<p><strong>Pellentesque habitant morbi tristique</strong> senectus et netus et malesuada fames ac turpis egestas. Vestibulum tortor quam, feugiat vitae, ultricies eget, tempor sit amet, ante. Donec eu libero sit amet quam egestas semper. <em>Aenean ultricies mi vitae est.</em> Mauris placerat eleifend leo. Quisque sit amet est et sapien ullamcorper pharetra. Vestibulum erat wisi, condimentum sed, <code>commodo vitae</code>, ornare sit amet, wisi. Aenean fermentum, elit eget tincidunt condimentum, eros ipsum rutrum orci, sagittis tempus lacus enim ac dui. <a href="#">Donec non enim</a> in turpis pulvinar facilisis. Ut felis.</p>

	<blockquote><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus magna. Cras in mi at felis aliquet congue. Ut a est eget ligula molestie gravida. Curabitur massa. Donec eleifend, libero at sagittis mollis, tellus est malesuada tellus, at luctus turpis elit sit amet quam. Vivamus pretium ornare est.</p></blockquote>

	<h3>Header Level 3</h3>

	<ul>
	   <li>Lorem ipsum dolor sit amet, consectetuer adipiscing elit.</li>
	   <li>Aliquam tincidunt mauris eu risus.</li>
	</ul>

	<pre><code>
	#header h1 a { 
		display: block; 
		width: 300px; 
		height: 80px; 
	}
	</code></pre>'
} %}


<section class="vignettes scrollbar-left">
	<div class="opacity-cache"></div>
	{% for i in 0..12 %}
		{% set this_color = random(colors) %}
		<div class="vignette" data-article-id="{{ i }}">
			<a href="#article">
				<div class="illustration" style="background-color:#{{ this_color }};"></div>
				<div class="title"><span>{{ article_listed.title }}</span></div>
			</a>
			<div class="triangle" style="border-color:transparent transparent #{{ this_color }} transparent;"></div>
			<div class="author">
				<a href="#author" class="photo">
					<img src="{{ article_listed.author.photo }}" alt="">
				</a>
			</div>
			<div class="categories">
				{% for category in categories %}
					<a href="#cat"><img src="{{ category.img }}" alt=""></a>
				{% endfor %}
			</div>
		</div>
	{% endfor %}
</section>

<article>
	{% include 'article.html.twig' %}
</article>

{# <a href="#" class="menu-button"><div><span></span></div></a> #}
{% endblock %}

{% block stylesheets %}
{{ parent() }}
<link rel="stylesheet" href="{{ asset('css/scrollbar.css') }}">
<link href='http://fonts.googleapis.com/css?family=Roboto+Slab:700,400' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Roboto:400,300' rel='stylesheet' type='text/css'>
{% endblock %}

{% block javascripts %}
{{ parent() }}
<script src="{{ asset('js/scrollbar.min.js') }}"></script>
<script>
Number.prototype.map=function(a,b,c,d){return c+(d-c)*((this-a)/(b-a))};

var $bgAuthor = $('article header .author'),
	headerHeight,
	maxTransparency = $bgAuthor.attr("data-max-transparency");
defineHeaderHeight();

$(window).resize(function() {
	defineHeaderHeight();
});

function defineHeaderHeight() {
	headerHeight = $("header").height()-$("header .author").height();
}

function replaceRegexOpacity(str, opacity) {
	return str.replace(/(rgba\(([0-9 ]+,){3}) *([0-9\.]+) *(\))/, "$1 "+opacity+"$4");
}

// scrollbars and author colored bar opacity
$(".vignettes").mCustomScrollbar({
	scrollInertia: 0,
	theme:"minimal"
});
$("article").mCustomScrollbar({
	scrollInertia: 0,
	theme:"minimal",
    callbacks:{
        whileScrolling:function(){
        	var ratio_header = -this.mcs.top/headerHeight;
        	if (ratio_header < 1) {
        		ratio_header = ratio_header.map(0, 1, parseFloat(maxTransparency), 1);
		        $bgAuthor.removeClass('fixed');
		        $bgAuthor.css("background-color", replaceRegexOpacity($bgAuthor.attr("data-bg-transparency"), ratio_header));
		    } else {
		        $bgAuthor.addClass('fixed');
		        $bgAuthor.css("background-color", replaceRegexOpacity($bgAuthor.css("backgroundColor"), 1));
		    }
        }
    }
});


$(".vignettes").on('click', '.vignette', function () {
	$(".vignettes .vignette").removeClass("selected");
	$(this).addClass("selected");
});


/*
// opacity cache over vignettes
$(".vignettes").hover(
	function() {
		$(".opacity-cache").removeClass("active");
	}, function() {
		$(".opacity-cache").addClass("active");
	}
);
//*/
</script>
{% endblock %}